---
title: "SesiÃ³n 3: Jugando a los Dados con el Presupuesto"
format: html
filters:
  - webr
---

# Caso de PolÃ­tica PÃºblica

La **DirecciÃ³n de Programas Sociales** debe presentar un presupuesto al Congreso para un programa de transferencias monetarias condicionadas. El problema: **mÃºltiples fuentes de incertidumbre**:

- ğŸ“¦ **Costo unitario** por beneficiario (varÃ­a por logÃ­stica, inflaciÃ³n)
- ğŸ‘¥ **NÃºmero de beneficiarios** (demanda fluctuante)
- ğŸš› **Costos logÃ­sticos** (transporte, operaciÃ³n regional)
- ğŸ’¸ **Tasa de deserciÃ³n** (beneficiarios que abandonan el programa)

**Tu tarea:** Usar simulaciÃ³n Monte Carlo para:
- Estimar el presupuesto necesario con su rango de incertidumbre
- Identificar el percentil 90 (para no quedarse corto)
- Comunicar el riesgo presupuestario al Director

**Regla de oro:** Planificar con el promedio es planificar para el fracaso. Necesitamos conocer la distribuciÃ³n completa.

---

# Parte 1: Concepto de SimulaciÃ³n Monte Carlo

**Â¿QuÃ© es Monte Carlo?**
- TÃ©cnica que usa muestreo aleatorio repetido
- "Tira los dados" miles de veces
- Genera distribuciÃ³n de resultados posibles
- Usado en finanzas, seguros, ingenierÃ­a, salud pÃºblica

**Â¿Por quÃ© lo necesitamos?**
En polÃ­tica pÃºblica, raramente sabemos un valor exacto. Sabemos:
- "El costo unitario estÃ¡ entre $10-15 USD, pero mÃ¡s probable cerca de $12"
- "Esperamos 5,000 beneficiarios Â± 400"
- "La logÃ­stica cuesta entre $30k-50k USD"

Monte Carlo convierte esta incertidumbre en nÃºmeros Ãºtiles para decidir.

---

# Parte 2: Componentes del Modelo

```{webr-r}
#| warning: false

# ConfiguraciÃ³n de simulaciÃ³n
set.seed(2026)
B <- 10000  # NÃºmero de simulaciones (10 mil escenarios)

cat("ğŸ² CONFIGURACIÃ“N DE LA SIMULACIÃ“N\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("Corriendo", B, "escenarios posibles...\n\n")

# COMPONENTE 1: Costo unitario por beneficiario (distribuciÃ³n log-normal)
# Log-normal porque: no puede ser negativo, tiene cola derecha (inflaciÃ³n extrema)
# Media esperada: $12 USD, pero con variabilidad

# ParÃ¡metros log-normal para mediaâ‰ˆ12, SDâ‰ˆ2.5
mu_log <- log(12)
sigma_log <- 0.25

costo_unitario <- rlnorm(B, meanlog = mu_log, sdlog = sigma_log)

cat("ğŸ’° COSTO UNITARIO (por beneficiario)\n")
cat("   DistribuciÃ³n: Log-normal\n")
cat("   Media:      $", round(mean(costo_unitario), 2), " USD\n")
cat("   Mediana:    $", round(median(costo_unitario), 2), " USD\n")
cat("   DE:         $", round(sd(costo_unitario), 2), " USD\n")
cat("   Rango:      $", round(min(costo_unitario), 2), " - $", 
    round(max(costo_unitario), 2), " USD\n\n")

# COMPONENTE 2: NÃºmero de beneficiarios (distribuciÃ³n normal)
# Normal porque: suma de muchos factores independientes
# Media esperada: 5,000, SD: 400

n_beneficiarios <- round(rnorm(B, mean = 5000, sd = 400))
# Asegurar que no haya valores negativos
n_beneficiarios <- pmax(n_beneficiarios, 3000)

cat("ğŸ‘¥ NÃšMERO DE BENEFICIARIOS\n")
cat("   DistribuciÃ³n: Normal (truncada en 3,000)\n")
cat("   Media:      ", round(mean(n_beneficiarios), 0), " personas\n")
cat("   Mediana:    ", round(median(n_beneficiarios), 0), " personas\n")
cat("   DE:         ", round(sd(n_beneficiarios), 0), " personas\n")
cat("   Rango:      ", min(n_beneficiarios), " - ", 
    max(n_beneficiarios), " personas\n\n")

# COMPONENTE 3: Costos logÃ­sticos (distribuciÃ³n gamma)
# Gamma porque: siempre positivo, puede tener cola derecha, flexible
# Media esperada: $40k USD

costos_logistica <- rgamma(B, shape = 5, rate = 1/8000)

cat("ğŸš› COSTOS LOGÃSTICOS (transporte, operaciÃ³n)\n")
cat("   DistribuciÃ³n: Gamma\n")
cat("   Media:      $", round(mean(costos_logistica), 0), " USD\n")
cat("   Mediana:    $", round(median(costos_logistica), 0), " USD\n")
cat("   DE:         $", round(sd(costos_logistica), 0), " USD\n")
cat("   Rango:      $", round(min(costos_logistica), 0), " - $", 
    round(max(costos_logistica), 0), " USD\n\n")

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

**Pregunta de reflexiÃ³n:** Â¿Por quÃ© usamos distribuciones diferentes para cada componente?

---

# Parte 3: CÃ¡lculo del Presupuesto Total

```{webr-r}
# MODELO: Presupuesto Total = (Costo Unitario Ã— Beneficiarios) + LogÃ­stica
presupuesto_total <- (costo_unitario * n_beneficiarios) + costos_logistica

cat("\nğŸ’µ PRESUPUESTO TOTAL SIMULADO\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

# EstadÃ­sticas descriptivas
cat("EstadÃ­sticas centrales:\n")
cat("  Media:      $", format(round(mean(presupuesto_total), 0), 
                              big.mark = ","), " USD\n")
cat("  Mediana:    $", format(round(median(presupuesto_total), 0), 
                              big.mark = ","), " USD\n")
cat("  DE:         $", format(round(sd(presupuesto_total), 0), 
                              big.mark = ","), " USD\n\n")

# Percentiles crÃ­ticos
percentiles <- quantile(presupuesto_total, 
                        probs = c(0.05, 0.10, 0.25, 0.50, 0.75, 0.90, 0.95))

cat("Percentiles (rango de escenarios posibles):\n")
cat("  P5  (optimista):     $", format(round(percentiles[1], 0), 
                                        big.mark = ","), "\n")
cat("  P10:                 $", format(round(percentiles[2], 0), 
                                        big.mark = ","), "\n")
cat("  P25 (cuartil inf):   $", format(round(percentiles[3], 0), 
                                        big.mark = ","), "\n")
cat("  P50 (mediana):       $", format(round(percentiles[4], 0), 
                                        big.mark = ","), "\n")
cat("  P75 (cuartil sup):   $", format(round(percentiles[5], 0), 
                                        big.mark = ","), "\n")
cat("  P90 (conservador):   $", format(round(percentiles[6], 0), 
                                        big.mark = ","), "\n")
cat("  P95 (muy conservador): $", format(round(percentiles[7], 0), 
                                          big.mark = ","), "\n\n")

# Rango intercuartil
iqr <- IQR(presupuesto_total)
cat("Rango Intercuartil (50% central): $", 
    format(round(iqr, 0), big.mark = ","), "\n\n")

# Coeficiente de variaciÃ³n
cv <- 100 * sd(presupuesto_total) / mean(presupuesto_total)
cat("Coeficiente de VariaciÃ³n: ", round(cv, 1), "%\n")
if (cv > 15) {
  cat("âš ï¸  Alta incertidumbre - considere planeaciÃ³n por escenarios\n")
}

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Parte 4: VisualizaciÃ³n de la DistribuciÃ³n

```{webr-r}
# Histograma de presupuestos simulados
hist(presupuesto_total / 1000,  # Convertir a miles para mejor lectura
     breaks = 60,
     col = "steelblue",
     border = "white",
     main = "DistribuciÃ³n de Presupuesto Total Simulado (10,000 escenarios)",
     xlab = "Presupuesto Total (miles USD)",
     ylab = "Frecuencia de escenarios",
     xlim = c(30, 100))

# LÃ­neas de referencia para percentiles clave
abline(v = percentiles[4] / 1000, col = "darkgreen", lwd = 3, lty = 1)  # P50
abline(v = percentiles[3] / 1000, col = "orange", lwd = 2, lty = 2)     # P25
abline(v = percentiles[5] / 1000, col = "orange", lwd = 2, lty = 2)     # P75
abline(v = percentiles[6] / 1000, col = "red", lwd = 3, lty = 3)        # P90

# Leyenda
legend("topright",
       legend = c("P50 (Mediana)", "P25/P75 (IQR)", "P90 (Conservador)"),
       col = c("darkgreen", "orange", "red"),
       lty = c(1, 2, 3),
       lwd = c(3, 2, 3),
       bty = "n",
       cex = 0.9)

# AnotaciÃ³n
text(x = percentiles[6] / 1000 + 5, 
     y = max(hist(presupuesto_total/1000, plot=F, breaks=60)$counts) * 0.7,
     paste0("10% de escenarios\nexceden $", 
            format(round(percentiles[6]/1000, 0), big.mark=","), "k"),
     pos = 4, col = "red", cex = 0.9)
```

**Interpreta el histograma:**
- Â¿La distribuciÃ³n es simÃ©trica o asimÃ©trica?
- Â¿Hay cola larga a la derecha? (escenarios de alto costo)
- Â¿QuÃ© tan separados estÃ¡n P25 y P75?

---

# Parte 5: AnÃ¡lisis de Riesgo Presupuestario

```{webr-r}
# Definir diferentes escenarios de presupuesto
escenarios <- c(55000, 60000, 65000, 70000)
nombres_esc <- c("Austero", "Moderado", "Prudente", "Conservador")

cat("\nğŸ“Š ANÃLISIS DE RIESGO: Â¿QuÃ© presupuesto solicitar?\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

for (i in 1:length(escenarios)) {
  presup <- escenarios[i]
  prob_suficiente <- 100 * mean(presupuesto_total <= presup)
  prob_insuficiente <- 100 - prob_suficiente
  
  cat(sprintf("%-15s ($%s):\n", 
              nombres_esc[i], 
              format(presup, big.mark = ",")))
  cat(sprintf("  âœ… Probabilidad de ser SUFICIENTE:   %5.1f%%\n", 
              prob_suficiente))
  cat(sprintf("  âŒ Probabilidad de QUEDARSE CORTO:   %5.1f%%\n", 
              prob_insuficiente))
  
  if (prob_insuficiente > 20) {
    cat("     âš ï¸  RIESGO ALTO - MÃ¡s del 20% de escenarios rebasan\n")
  } else if (prob_insuficiente > 10) {
    cat("     âš ï¸  Riesgo moderado\n")
  } else {
    cat("     âœ… Riesgo bajo - Presupuesto conservador\n")
  }
  cat("\n")
}

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

**Pregunta de polÃ­tica:**
- Â¿QuÃ© nivel de riesgo es aceptable?
- Â¿PreferirÃ­as quedarte corto en 5% o 20% de los escenarios?
- Â¿QuÃ© costo polÃ­tico tiene pedir presupuesto suplementario?

---

# Parte 6: AnÃ¡lisis de Sensibilidad

**Â¿QuÃ© componente genera mÃ¡s incertidumbre?**

```{webr-r}
cat("\nğŸ” ANÃLISIS DE SENSIBILIDAD\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

# Calcular contribuciÃ³n de cada componente a la varianza total
var_costo_unit <- var(costo_unitario * n_beneficiarios)
var_logistica <- var(costos_logistica)
var_total <- var(presupuesto_total)

cat("Varianza de componentes:\n")
cat("  Costo unit Ã— Benef:  $", 
    format(round(var_costo_unit, 0), big.mark = ","), "Â²\n")
cat("  LogÃ­stica:           $", 
    format(round(var_logistica, 0), big.mark = ","), "Â²\n")
cat("  Total:               $", 
    format(round(var_total, 0), big.mark = ","), "Â²\n\n")

pct_costo_unit <- 100 * var_costo_unit / var_total
pct_logistica <- 100 * var_logistica / var_total

cat("ContribuciÃ³n porcentual a la incertidumbre:\n")
cat("  Costo unit Ã— Benef:  ", round(pct_costo_unit, 1), "%\n")
cat("  LogÃ­stica:           ", round(pct_logistica, 1), "%\n\n")

if (pct_costo_unit > 70) {
  cat("ğŸ’¡ INSIGHT: La mayor fuente de incertidumbre es la combinaciÃ³n\n")
  cat("   de costo unitario y nÃºmero de beneficiarios.\n")
  cat("   RECOMENDACIÃ“N: Invertir en mejor estimaciÃ³n de demanda\n")
  cat("   y contratos fijos para reducir variabilidad de costo.\n")
} else {
  cat("ğŸ’¡ INSIGHT: Los costos logÃ­sticos son la principal fuente\n")
  cat("   de incertidumbre.\n")
  cat("   RECOMENDACIÃ“N: Negociar contratos logÃ­sticos con precios fijos.\n")
}

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Parte 7: ComparaciÃ³n de Estrategias

```{webr-r}
# Simular efecto de diferentes estrategias para reducir incertidumbre

cat("\nğŸ¯ COMPARACIÃ“N DE ESTRATEGIAS DE MITIGACIÃ“N\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

# ESTRATEGIA A: Contrato fijo de costo unitario (reduce SD a la mitad)
costo_fijo <- rlnorm(B, meanlog = mu_log, sdlog = sigma_log/2)
presup_estrategia_a <- (costo_fijo * n_beneficiarios) + costos_logistica

cat("ESTRATEGIA A: Contrato fijo con proveedores\n")
cat("  P50:  $", format(round(median(presup_estrategia_a), 0), 
                        big.mark = ","), "\n")
cat("  P90:  $", format(round(quantile(presup_estrategia_a, 0.90), 0), 
                        big.mark = ","), "\n")
cat("  IQR:  $", format(round(IQR(presup_estrategia_a), 0), 
                        big.mark = ","), "\n\n")

# ESTRATEGIA B: Pre-registro para reducir incertidumbre en beneficiarios
benef_estables <- round(rnorm(B, mean = 5000, sd = 200))  # SD reducido
benef_estables <- pmax(benef_estables, 3000)
presup_estrategia_b <- (costo_unitario * benef_estables) + costos_logistica

cat("ESTRATEGIA B: Pre-registro de beneficiarios\n")
cat("  P50:  $", format(round(median(presup_estrategia_b), 0), 
                        big.mark = ","), "\n")
cat("  P90:  $", format(round(quantile(presup_estrategia_b, 0.90), 0), 
                        big.mark = ","), "\n")
cat("  IQR:  $", format(round(IQR(presup_estrategia_b), 0), 
                        big.mark = ","), "\n\n")

# ESTRATEGIA C: Ambas (contratos fijos + pre-registro)
presup_estrategia_c <- (costo_fijo * benef_estables) + costos_logistica

cat("ESTRATEGIA C: Contratos fijos + Pre-registro\n")
cat("  P50:  $", format(round(median(presup_estrategia_c), 0), 
                        big.mark = ","), "\n")
cat("  P90:  $", format(round(quantile(presup_estrategia_c, 0.90), 0), 
                        big.mark = ","), "\n")
cat("  IQR:  $", format(round(IQR(presup_estrategia_c), 0), 
                        big.mark = ","), "\n\n")

# ComparaciÃ³n de reducciÃ³n de riesgo
reduccion_iqr_c <- 100 * (1 - IQR(presup_estrategia_c) / IQR(presupuesto_total))

cat("ğŸ’¡ RESULTADO:\n")
cat("   Implementar ambas estrategias reduce la incertidumbre\n")
cat("   (medida por IQR) en un ", round(reduccion_iqr_c, 1), "%\n\n")

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Parte 8: VisualizaciÃ³n Comparativa

```{webr-r}
# Boxplot comparativo de las 4 estrategias
datos_comparacion <- data.frame(
  presupuesto = c(presupuesto_total, 
                  presup_estrategia_a,
                  presup_estrategia_b,
                  presup_estrategia_c) / 1000,
  estrategia = rep(c("Base", "Contratos Fijos", 
                     "Pre-registro", "Ambas"),
                   each = B)
)

boxplot(presupuesto ~ estrategia,
        data = datos_comparacion,
        col = c("gray", "lightblue", "lightgreen", "gold"),
        main = "ComparaciÃ³n de Estrategias de MitigaciÃ³n de Riesgo",
        ylab = "Presupuesto Total (miles USD)",
        xlab = "Estrategia",
        las = 2,  # Rotar etiquetas
        ylim = c(30, 100))

# LÃ­nea de referencia P90 base
abline(h = percentiles[6] / 1000, col = "red", lty = 2, lwd = 2)
text(1, percentiles[6]/1000 + 3, 
     "P90 sin mitigaciÃ³n", pos = 4, col = "red", cex = 0.8)
```

**AnÃ¡lisis visual:**
- Â¿QuÃ© estrategia reduce mÃ¡s la dispersiÃ³n?
- Â¿Hay trade-offs entre reducir incertidumbre y costo esperado?

---

# Parte 9: Tabla de DecisiÃ³n para el Director

```{webr-r}
cat("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("  MEMO PARA DECISIÃ“N: PRESUPUESTO PROGRAMA TMC 2026\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

cat("RESUMEN EJECUTIVO\n\n")

cat("Basado en 10,000 simulaciones Monte Carlo considerando:\n")
cat("  â€¢ Variabilidad en costo unitario (inflaciÃ³n, logÃ­stica)\n")
cat("  â€¢ Incertidumbre en nÃºmero de beneficiarios (demanda)\n")
cat("  â€¢ FluctuaciÃ³n en costos logÃ­sticos regionales\n\n")

cat("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n")
cat("â”‚ RECOMENDACIÃ“N DE PRESUPUESTO                            â”‚\n")
cat("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n")

cat("OpciÃ³n 1: CONSERVADORA (P90)\n")
cat("  Monto:       $", format(round(percentiles[6], 0), big.mark = ","), 
    " USD\n")
cat("  Riesgo:      Solo 10% de escenarios rebasan este monto\n")
cat("  Beneficio:   Evita presupuesto suplementario\n")
cat("  Costo:       PodrÃ­a sobrar presupuesto en escenarios favorables\n\n")

cat("OpciÃ³n 2: PRUDENTE (P75)\n")
cat("  Monto:       $", format(round(percentiles[5], 0), big.mark = ","), 
    " USD\n")
cat("  Riesgo:      25% de escenarios rebasan este monto\n")
cat("  Beneficio:   Balance entre prudencia y eficiencia\n")
cat("  Costo:       PodrÃ­a requerir ajuste presupuestal\n\n")

cat("OpciÃ³n 3: MEDIANA (P50)\n")
cat("  Monto:       $", format(round(percentiles[4], 0), big.mark = ","), 
    " USD\n")
cat("  Riesgo:      50% de escenarios rebasan este monto\n")
cat("  Beneficio:   Uso eficiente de recursos\n")
cat("  Costo:       Alta probabilidad de necesitar suplemento\n\n")

cat("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n")
cat("â”‚ RECOMENDACIÃ“N FINAL                                     â”‚\n")
cat("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n")

cat("Solicitar: $", format(round(percentiles[6], 0), big.mark = ","), 
    " USD (P90)\n\n")

cat("JustificaciÃ³n:\n")
cat("  1. Minimiza riesgo polÃ­tico de presupuesto insuficiente\n")
cat("  2. Costo de suplemento > Costo de sobre-estimar\n")
cat("  3. Excedentes pueden reasignarse dentro del sector\n\n")

cat("AdemÃ¡s, IMPLEMENTAR:\n")
cat("  â€¢ Estrategia de contratos fijos con proveedores\n")
cat("  â€¢ Pre-registro de beneficiarios para reducir incertidumbre\n")
cat("  â†’ ReducciÃ³n esperada de IQR: ", round(reduccion_iqr_c, 1), "%\n\n")

cat("LIMITACIONES:\n")
cat("  âš ï¸  Modelo NO considera:\n")
cat("      - Shocks macroeconÃ³micos extremos (crisis)\n")
cat("      - Cambios regulatorios durante ejecuciÃ³n\n")
cat("      - VariaciÃ³n geogrÃ¡fica en costos\n")
cat("      - EconomÃ­as de escala con mÃ¡s beneficiarios\n\n")

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Parte 10: SimulaciÃ³n de Escenarios Extremos

```{webr-r}
# Â¿QuÃ© pasa en el peor escenario razonable?
cat("\nğŸš¨ ANÃLISIS DE ESCENARIOS EXTREMOS\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

# Peor 5% de escenarios
peor_5pct <- presupuesto_total >= quantile(presupuesto_total, 0.95)
presup_extremo <- presupuesto_total[peor_5pct]

cat("ESCENARIO PESIMISTA (Peor 5%):\n")
cat("  Presupuesto mÃ­nimo:  $", 
    format(round(min(presup_extremo), 0), big.mark = ","), "\n")
cat("  Presupuesto mÃ¡ximo:  $", 
    format(round(max(presup_extremo), 0), big.mark = ","), "\n")
cat("  Promedio en peor 5%: $", 
    format(round(mean(presup_extremo), 0), big.mark = ","), "\n\n")

# Â¿QuÃ© combinaciÃ³n lleva al peor escenario?
idx_peor <- which.max(presupuesto_total)
cat("EL PEOR ESCENARIO ÃšNICO:\n")
cat("  Presupuesto total:   $", 
    format(round(presupuesto_total[idx_peor], 0), big.mark = ","), "\n")
cat("  Costo unitario:      $", round(costo_unitario[idx_peor], 2), "\n")
cat("  Beneficiarios:       ", n_beneficiarios[idx_peor], "\n")
cat("  LogÃ­stica:           $", 
    format(round(costos_logistica[idx_peor], 0), big.mark = ","), "\n\n")

# Mejor escenario
idx_mejor <- which.min(presupuesto_total)
cat("EL MEJOR ESCENARIO:\n")
cat("  Presupuesto total:   $", 
    format(round(presupuesto_total[idx_mejor], 0), big.mark = ","), "\n")
cat("  Costo unitario:      $", round(costo_unitario[idx_mejor], 2), "\n")
cat("  Beneficiarios:       ", n_beneficiarios[idx_mejor], "\n")
cat("  LogÃ­stica:           $", 
    format(round(costos_logistica[idx_mejor], 0), big.mark = ","), "\n\n")

cat("RANGO TOTAL (min-max):  $", 
    format(round(max(presupuesto_total) - min(presupuesto_total), 0), 
           big.mark = ","), "\n")

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Ejercicio Individual (Entregable)

**Parte A: Modificar Supuestos**

1. **Re-simula el modelo** con beneficiarios mÃ¡s variables:
   - Cambia SD de 400 a 800
   - Â¿CÃ³mo cambia el P90?
   - Â¿CuÃ¡nto mÃ¡s presupuesto necesitarÃ­as?

2. **Escenario de inflaciÃ³n:**
   - Aumenta el costo unitario promedio de $12 a $14
   - MantÃ©n todo lo demÃ¡s igual
   - Calcula el nuevo P90 y compara

**Parte B: AnÃ¡lisis Escrito**

3. **Tabla comparativa** de las 4 estrategias:
   - Columnas: Estrategia, P50, P90, IQR, Costo de implementaciÃ³n
   - Â¿CuÃ¡l recomendarÃ­as y por quÃ©?

4. **Escribe un pÃ¡rrafo** (6 lÃ­neas) explicando:
   - Â¿Por quÃ© NO usar solo el promedio?
   - Â¿QuÃ© percentil usarÃ­as para presupuestar?
   - Â¿QuÃ© riesgo implica cada opciÃ³n (P50 vs P90)?

**Parte C: ComunicaciÃ³n**

5. **Crea un memo de 1 pÃ¡gina** para el Director que incluya:
   - RecomendaciÃ³n de monto (con percentil)
   - 1 grÃ¡fico (histograma o boxplot)
   - 2-3 supuestos clave
   - 2 limitaciones del modelo

---

# Preguntas de DiscusiÃ³n

1. **PlanificaciÃ³n Conservadora vs Eficiente:**
   - Â¿QuÃ© costo tiene planificar con P90 vs P50?
   - Â¿En quÃ© contextos polÃ­ticos usarÃ­as cada uno?

2. **ComunicaciÃ³n de Incertidumbre:**
   - Â¿CÃ³mo le explicas al Congreso "90% de confianza"?
   - Â¿PreferirÃ­as dar un rango o un nÃºmero Ãºnico?

3. **Mejora del Modelo:**
   - Â¿QuÃ© otras fuentes de incertidumbre agregarÃ­as?
   - Â¿CÃ³mo modelarÃ­as economÃ­as de escala?

4. **Ã‰tica de la Incertidumbre:**
   - Â¿Es Ã©tico pedir presupuesto conservador sabiendo que podrÃ­a sobrar?
   - Â¿PreferirÃ­as quedarte corto o sobre-estimar?

---

# Recursos Adicionales

**Conceptos clave:**

- **SimulaciÃ³n Monte Carlo:** Muestreo aleatorio repetido para generar distribuciÃ³n de resultados
- **Distribuciones:**
  - Normal: Suma de factores independientes
  - Log-normal: Variables siempre positivas con cola derecha
  - Gamma: Tiempo hasta eventos, costos agregados
- **Percentiles de riesgo:**
  - P90: Conservador (10% rebasa)
  - P75: Prudente (25% rebasa)
  - P50: Neutral (50% rebasa)
- **AnÃ¡lisis de sensibilidad:** Identificar quÃ© input genera mÃ¡s varianza en output

**Usos en polÃ­tica pÃºblica:**

- ğŸ’° PlanificaciÃ³n presupuestaria
- ğŸ“Š AnÃ¡lisis costo-beneficio
- ğŸ¥ Proyecciones de demanda en salud
- ğŸŒ¾ EvaluaciÃ³n de riesgo en programas agrÃ­colas
- âš¡ Proyecciones de energÃ­a
- ğŸ“ PlanificaciÃ³n de infraestructura educativa

**Para profundizar:**
- Busca "Black Swan" de Nassim Taleb (eventos extremos)
- Investiga "Value at Risk" (VaR) en finanzas
- Lee sobre "Precautionary Principle" en polÃ­tica ambiental

---

**Ãšltima reflexiÃ³n:** En un mundo incierto, dar un solo nÃºmero es mentir. La distribuciÃ³n completa es la verdad.
