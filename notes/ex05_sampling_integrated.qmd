---
title: "SesiÃ³n 5: El Arte del Muestreo"
format: html
filters:
  - webr
---

# Caso: Encuesta de AprobaciÃ³n Presidencial

El **Instituto Electoral** debe estimar la aprobaciÃ³n presidencial para presupuestar campaÃ±as. La verdad poblacional es 52% de aprobaciÃ³n, pero solo podemos encuestar una muestra.

**Preguntas:**
- Â¿QuÃ© tan grande debe ser la muestra?
- Â¿CuÃ¡nto varÃ­a el resultado con muestras pequeÃ±as vs grandes?
- Â¿CuÃ¡l es el margen de error esperado?

```{webr-r}
library(ggplot2)
set.seed(2026)

# VERDAD POBLACIONAL (desconocida en la realidad)
aprobacion_real <- 0.52
N_poblacion <- 50000000  # 50 millones de votantes

cat("ğŸ—³ï¸  PARÃMETROS POBLACIONALES\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("AprobaciÃ³n real:    ", aprobacion_real*100, "%\n")
cat("PoblaciÃ³n total:    ", format(N_poblacion, big.mark=","), "\n\n")
```

---

# Parte 1: Experimento con Diferentes TamaÃ±os de Muestra

```{webr-r}
# Simular 1000 encuestas con diferentes tamaÃ±os
n_simulaciones <- 1000
tamanos_muestra <- c(30, 100, 300, 1000, 3000)

resultados <- data.frame()

for (n in tamanos_muestra) {
  estimaciones <- replicate(n_simulaciones, {
    muestra <- sample(c(0, 1), n, replace=TRUE, prob=c(1-aprobacion_real, aprobacion_real))
    mean(muestra)
  })
  
  temp_df <- data.frame(
    n = n,
    estimacion = estimaciones
  )
  resultados <- rbind(resultados, temp_df)
}

cat("ğŸ“Š ESTADÃSTICAS POR TAMAÃ‘O DE MUESTRA\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

for (n in tamanos_muestra) {
  subset_data <- resultados$estimacion[resultados$n == n]
  media <- mean(subset_data)
  ee <- sd(subset_data)  # Error estÃ¡ndar empÃ­rico
  
  cat("n =", n, "\n")
  cat("  Media de estimaciones:  ", round(media, 4), "\n")
  cat("  Error EstÃ¡ndar:         ", round(ee, 4), "\n")
  cat("  Rango (min-max):        ", round(min(subset_data), 3), "-", 
      round(max(subset_data), 3), "\n\n")
}
```

---

# Parte 2: VisualizaciÃ³n de la Convergencia

```{webr-r}
# Boxplot comparativo
boxplot(estimacion ~ n, data=resultados,
        col=rainbow(length(tamanos_muestra)),
        main="DistribuciÃ³n de Estimaciones segÃºn TamaÃ±o de Muestra",
        xlab="TamaÃ±o de muestra (n)",
        ylab="AprobaciÃ³n estimada",
        ylim=c(0.35, 0.70))

abline(h=aprobacion_real, col="red", lwd=3, lty=2)
text(3, aprobacion_real+0.02, "Verdad = 52%", col="red", pos=3)

# Histogramas superpuestos
par(mfrow=c(2, 3))
for (n in tamanos_muestra) {
  subset_data <- resultados$estimacion[resultados$n == n]
  hist(subset_data, 
       breaks=30,
       col=rgb(0.2, 0.4, 0.8, 0.6),
       border="white",
       main=paste("n =", n),
       xlab="AprobaciÃ³n estimada",
       xlim=c(0.35, 0.70))
  abline(v=aprobacion_real, col="red", lwd=2)
  abline(v=mean(subset_data), col="blue", lwd=2, lty=2)
}
par(mfrow=c(1, 1))
```

---

# Parte 3: FÃ³rmula del Error EstÃ¡ndar

```{webr-r}
cat("\nğŸ“ ERROR ESTÃNDAR TEÃ“RICO vs EMPÃRICO\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

for (n in tamanos_muestra) {
  # TeÃ³rico: SE = sqrt(p*(1-p)/n)
  se_teorico <- sqrt(aprobacion_real * (1-aprobacion_real) / n)
  
  # EmpÃ­rico: DE de las 1000 simulaciones
  se_empirico <- sd(resultados$estimacion[resultados$n == n])
  
  cat("n =", n, "\n")
  cat("  SE teÃ³rico:   ", round(se_teorico, 5), "\n")
  cat("  SE empÃ­rico:  ", round(se_empirico, 5), "\n")
  cat("  Diferencia:   ", round(abs(se_teorico - se_empirico), 5), "\n\n")
}

cat("ğŸ’¡ INSIGHT: El error estÃ¡ndar disminuye con âˆšn, no con n.\n")
cat("   Para reducir el error a la mitad, necesitas 4Ã— mÃ¡s gente.\n\n")
```

---

# Ejercicio Individual

1. **Simula** una encuesta con n=500 y calcula intervalo [estimaciÃ³n Â± 2Ã—SE]
2. **Compara** costo-beneficio de n=1000 vs n=3000
3. **Recomienda** tamaÃ±o de muestra para margen de error <3%

---

# DiscusiÃ³n

- Â¿CuÃ¡ndo vale la pena una muestra grande?
- Â¿Sesgo vs varianza: quÃ© es peor?
- Â¿CÃ³mo afecta la no-respuesta?

