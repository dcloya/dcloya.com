---
title: "SesiÃ³n 2: VisualizaciÃ³n como Evidencia"
format: html
filters:
  - webr
---

# Caso de PolÃ­tica PÃºblica

El **Secretario de EducaciÃ³n** debe decidir cÃ³mo distribuir recursos adicionales entre escuelas pÃºblicas. Tiene datos de 120 escuelas con informaciÃ³n sobre:
- Puntaje promedio en prueba estandarizada (0-100)
- Presupuesto anual por estudiante (miles de USD)
- Tipo de escuela (Urbana vs Rural)

**Tu tarea:** Crear visualizaciones que ayuden a responder:
- Â¿MÃ¡s presupuesto se traduce en mejor desempeÃ±o?
- Â¿Hay diferencias sistemÃ¡ticas entre escuelas urbanas y rurales?
- Â¿DÃ³nde estÃ¡n las mejores oportunidades de mejora?

**Regla de oro:** Un grÃ¡fico en polÃ­tica pÃºblica no es decoraciÃ³n; es un argumento basado en evidencia.

---

# Parte 1: SimulaciÃ³n y Carga de Datos

```{webr-r}
#| warning: false

library(ggplot2)

# SimulaciÃ³n de datos educativos
set.seed(2026)
n_urbano <- 80
n_rural <- 40

# Escuelas URBANAS: mayor presupuesto pero mÃ¡s variabilidad
presup_urbano <- rnorm(n_urbano, mean = 8, sd = 2)  # miles USD
# Efecto del presupuesto + ruido + efecto fijo urbano
puntaje_urbano <- 55 + 2.5 * presup_urbano + rnorm(n_urbano, 0, 8) + 5

# Escuelas RURALES: menor presupuesto, mayor efecto marginal
presup_rural <- rnorm(n_rural, mean = 5, sd = 1.5)
# Efecto mÃ¡s fuerte del presupuesto en contexto rural
puntaje_rural <- 45 + 4 * presup_rural + rnorm(n_rural, 0, 6)

# Crear base de datos
escuelas <- data.frame(
  id_escuela = 1:(n_urbano + n_rural),
  presupuesto_anual_kusd = c(presup_urbano, presup_rural),
  puntaje_prueba = c(puntaje_urbano, puntaje_rural),
  tipo = c(rep("Urbana", n_urbano), rep("Rural", n_rural))
)

# Asegurar que puntajes estÃ©n en rango vÃ¡lido
escuelas$puntaje_prueba <- pmax(0, pmin(100, escuelas$puntaje_prueba))

# Vista previa
head(escuelas, 10)
cat("\nğŸ“š Total de escuelas:", nrow(escuelas), "\n")
cat("   - Urbanas:", n_urbano, "\n")
cat("   - Rurales:", n_rural, "\n")
```

---

# Parte 2: EstadÃ­sticas Descriptivas por Tipo

```{webr-r}
# FunciÃ³n para calcular estadÃ­sticas completas
resumen_estadistico <- function(x) {
  c(
    n = length(x),
    Media = mean(x),
    Mediana = median(x),
    DE = sd(x),
    Min = min(x),
    P25 = quantile(x, 0.25),
    P75 = quantile(x, 0.75),
    Max = max(x),
    IQR = IQR(x)
  )
}

cat("\nğŸ“Š RESUMEN: PUNTAJE EN PRUEBA ESTANDARIZADA\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
by(escuelas$puntaje_prueba, escuelas$tipo, resumen_estadistico)

cat("\n\nğŸ’° RESUMEN: PRESUPUESTO ANUAL (miles USD)\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
by(escuelas$presupuesto_anual_kusd, escuelas$tipo, resumen_estadistico)

# Tabla comparativa lado a lado
cat("\n\nğŸ“‹ COMPARACIÃ“N DIRECTA\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat(sprintf("%-25s %12s %12s %12s\n", "Variable", "Urbana", "Rural", "Diferencia"))
cat("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n")

# Puntaje promedio
punt_urb <- mean(escuelas$puntaje_prueba[escuelas$tipo == "Urbana"])
punt_rur <- mean(escuelas$puntaje_prueba[escuelas$tipo == "Rural"])
cat(sprintf("%-25s %12.2f %12.2f %12.2f\n", "Puntaje promedio", 
            punt_urb, punt_rur, punt_urb - punt_rur))

# Puntaje mediano
med_punt_urb <- median(escuelas$puntaje_prueba[escuelas$tipo == "Urbana"])
med_punt_rur <- median(escuelas$puntaje_prueba[escuelas$tipo == "Rural"])
cat(sprintf("%-25s %12.2f %12.2f %12.2f\n", "Puntaje mediano", 
            med_punt_urb, med_punt_rur, med_punt_urb - med_punt_rur))

# Presupuesto promedio
pres_urb <- mean(escuelas$presupuesto_anual_kusd[escuelas$tipo == "Urbana"])
pres_rur <- mean(escuelas$presupuesto_anual_kusd[escuelas$tipo == "Rural"])
cat(sprintf("%-25s %12.2f %12.2f %12.2f\n", "Presupuesto (kUSD)", 
            pres_urb, pres_rur, pres_urb - pres_rur))

# DispersiÃ³n (IQR)
iqr_urb <- IQR(escuelas$puntaje_prueba[escuelas$tipo == "Urbana"])
iqr_rur <- IQR(escuelas$puntaje_prueba[escuelas$tipo == "Rural"])
cat(sprintf("%-25s %12.2f %12.2f %12.2f\n", "IQR Puntaje", 
            iqr_urb, iqr_rur, iqr_urb - iqr_rur))

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

**Pregunta de reflexiÃ³n:** Â¿Las escuelas urbanas tienen mayor variabilidad? Â¿QuÃ© implica esto para la intervenciÃ³n?

---

# Parte 3: VisualizaciÃ³n Esencial - El Boxplot

**Â¿Por quÃ© boxplot?** Porque muestra de un vistazo:
- El "tÃ­pico" (mediana)
- La dispersiÃ³n (IQR)
- Los valores extremos (outliers)
- Permite comparar grupos fÃ¡cilmente

```{webr-r}
# Boxplot bÃ¡sico pero informativo
boxplot(puntaje_prueba ~ tipo, 
        data = escuelas,
        col = c("#FF6B6B", "#4ECDC4"),
        main = "DistribuciÃ³n de Puntajes por Tipo de Escuela",
        ylab = "Puntaje en Prueba Estandarizada (0-100)",
        xlab = "Tipo de Escuela",
        border = "gray30",
        notch = FALSE,
        horizontal = FALSE,
        outcol = "red",
        outpch = 19,
        outcex = 1.2)

# Agregar lÃ­nea de referencia: puntaje mÃ­nimo aceptable
abline(h = 60, col = "orange", lwd = 2, lty = 2)
text(1.5, 62, "Meta mÃ­nima: 60 puntos", pos = 4, col = "orange", cex = 0.9)

# Agregar la media como punto
points(c(1, 2), c(punt_urb, punt_rur), 
       pch = 18, col = "blue", cex = 2.5)
legend("bottomright", 
       legend = c("Mediana (lÃ­nea)", "Media (rombo)"),
       pch = c(NA, 18),
       lty = c(1, NA),
       col = c("black", "blue"),
       bty = "n")

# Anotar elementos del boxplot
mtext("LÃ­nea central = MEDIANA (hogar tÃ­pico)", 
      side = 3, line = -2, at = 1, cex = 0.75, col = "gray30")
mtext("Caja = IQR (50% central de escuelas)", 
      side = 3, line = -3, at = 1, cex = 0.75, col = "gray30")
mtext("Puntos rojos = Outliers (casos extremos)", 
      side = 3, line = -4, at = 1, cex = 0.75, col = "red")
```

**Interpreta el boxplot:**
1. Â¿QuÃ© grupo tiene mayor dispersiÃ³n?
2. Â¿Hay outliers? Â¿Son positivos (escuelas excepcionales) o negativos?
3. Â¿Se traslapan las cajas? Â¿QuÃ© significa esto?

---

# Parte 4: AnÃ¡lisis de DispersiÃ³n y Desigualdad

```{webr-r}
# Identificar escuelas por cuartil de desempeÃ±o
escuelas$cuartil <- cut(escuelas$puntaje_prueba,
                        breaks = quantile(escuelas$puntaje_prueba, 
                                         probs = c(0, 0.25, 0.5, 0.75, 1)),
                        labels = c("Q1 (bajo)", "Q2", "Q3", "Q4 (alto)"),
                        include.lowest = TRUE)

# Tabla de distribuciÃ³n por cuartil y tipo
cat("\nğŸ“Š DISTRIBUCIÃ“N DE ESCUELAS POR CUARTIL DE DESEMPEÃ‘O\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
tabla <- table(escuelas$tipo, escuelas$cuartil)
print(tabla)

cat("\nProporciÃ³n por tipo:\n")
print(prop.table(tabla, margin = 1) * 100)  # Por fila (tipo)

# Identificar escuelas con bajo desempeÃ±o (bottom 25%)
escuelas_bajo_desempeno <- escuelas[escuelas$cuartil == "Q1 (bajo)", ]
cat("\nğŸ”´ ESCUELAS DE BAJO DESEMPEÃ‘O (Q1)\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("Total:", nrow(escuelas_bajo_desempeno), "escuelas\n")
cat("Urbanas:", sum(escuelas_bajo_desempeno$tipo == "Urbana"), "\n")
cat("Rurales:", sum(escuelas_bajo_desempeno$tipo == "Rural"), "\n")
cat("\nPresupuesto promedio en este grupo: $", 
    round(mean(escuelas_bajo_desempeno$presupuesto_anual_kusd), 2), "k USD\n")
cat("Puntaje promedio: ", round(mean(escuelas_bajo_desempeno$puntaje_prueba), 1), "\n")
```

---

# Parte 5: Scatterplot - RelaciÃ³n Presupuesto-DesempeÃ±o

```{webr-r}
# Scatterplot con diferenciaciÃ³n por tipo
plot(escuelas$presupuesto_anual_kusd, 
     escuelas$puntaje_prueba,
     pch = ifelse(escuelas$tipo == "Urbana", 19, 17),
     col = ifelse(escuelas$tipo == "Urbana", "#FF6B6B", "#4ECDC4"),
     cex = 1.3,
     main = "RelaciÃ³n Presupuesto-DesempeÃ±o por Tipo de Escuela",
     xlab = "Presupuesto Anual por Estudiante (miles USD)",
     ylab = "Puntaje en Prueba Estandarizada",
     xlim = c(0, 14),
     ylim = c(0, 100))

# LÃ­neas de tendencia por grupo
urbanas <- escuelas[escuelas$tipo == "Urbana", ]
rurales <- escuelas[escuelas$tipo == "Rural", ]

modelo_urb <- lm(puntaje_prueba ~ presupuesto_anual_kusd, data = urbanas)
modelo_rur <- lm(puntaje_prueba ~ presupuesto_anual_kusd, data = rurales)

abline(modelo_urb, col = "#FF6B6B", lwd = 3)
abline(modelo_rur, col = "#4ECDC4", lwd = 3)

# LÃ­nea de meta mÃ­nima
abline(h = 60, col = "orange", lty = 2, lwd = 2)

# Leyenda
legend("bottomright",
       legend = c("Urbana", "Rural", "Meta (60 pts)"),
       pch = c(19, 17, NA),
       lty = c(1, 1, 2),
       col = c("#FF6B6B", "#4ECDC4", "orange"),
       lwd = c(3, 3, 2),
       bty = "n")

# Identificar outliers interesantes (alto presupuesto, bajo desempeÃ±o)
bajo_desempeno_alto_presup <- escuelas[
  escuelas$puntaje_prueba < 60 & escuelas$presupuesto_anual_kusd > 8, 
]

if (nrow(bajo_desempeno_alto_presup) > 0) {
  points(bajo_desempeno_alto_presup$presupuesto_anual_kusd,
         bajo_desempeno_alto_presup$puntaje_prueba,
         pch = 1, col = "red", cex = 3, lwd = 2)
  text(bajo_desempeno_alto_presup$presupuesto_anual_kusd,
       bajo_desempeno_alto_presup$puntaje_prueba,
       "Problema\nde gestiÃ³n?",
       pos = 4, col = "red", cex = 0.8)
}
```

**AnÃ¡lisis del scatterplot:**
1. Â¿La relaciÃ³n es lineal o se aplana en algÃºn punto?
2. Â¿Las pendientes son iguales para urbanas y rurales?
3. Â¿Hay escuelas que estÃ¡n "fuera de la curva"? (outliers influyentes)

---

# Parte 6: CÃ¡lculo de Pendientes (Retorno del Presupuesto)

```{webr-r}
cat("\nğŸ“ˆ RETORNO DEL PRESUPUESTO (Pendiente de RegresiÃ³n)\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

# Pendiente para escuelas urbanas
slope_urb <- coef(modelo_urb)[2]
cat("ESCUELAS URBANAS:\n")
cat("  Por cada $1,000 USD adicionales de presupuesto anual,\n")
cat("  el puntaje aumenta en promedio:", round(slope_urb, 2), "puntos\n\n")

# Pendiente para escuelas rurales
slope_rur <- coef(modelo_rur)[2]
cat("ESCUELAS RURALES:\n")
cat("  Por cada $1,000 USD adicionales de presupuesto anual,\n")
cat("  el puntaje aumenta en promedio:", round(slope_rur, 2), "puntos\n\n")

# ComparaciÃ³n
diferencia_slopes <- slope_rur - slope_urb
cat("DIFERENCIA:\n")
cat("  Las escuelas rurales tienen un retorno", 
    round(abs(diferencia_slopes), 2), "puntos")
if (diferencia_slopes > 0) {
  cat(" MAYOR por cada $1k USD\n")
  cat("  â†’ Invertir en rurales puede ser mÃ¡s eficiente\n")
} else {
  cat(" MENOR por cada $1k USD\n")
}

# RÂ² (quÃ© tan bien explica el presupuesto el desempeÃ±o)
r2_urb <- summary(modelo_urb)$r.squared
r2_rur <- summary(modelo_rur)$r.squared

cat("\nğŸ“Š PODER EXPLICATIVO (RÂ²):\n")
cat("  Urbanas: El presupuesto explica el", round(100 * r2_urb, 1), 
    "% de la variaciÃ³n en puntajes\n")
cat("  Rurales: El presupuesto explica el", round(100 * r2_rur, 1), 
    "% de la variaciÃ³n en puntajes\n\n")

if (r2_urb < 0.5) {
  cat("âš ï¸  ADVERTENCIA: El presupuesto explica MENOS de la mitad de la variaciÃ³n.\n")
  cat("   Otros factores son importantes (calidad docente, infraestructura, contexto)\n")
}

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

**Importante:** CorrelaciÃ³n â‰  Causalidad. Esta pendiente sugiere una asociaciÃ³n, pero no prueba que aumentar presupuesto *cause* mejor desempeÃ±o.

---

# Parte 7: Histograma de Presupuesto

```{webr-r}
# Histogramas superpuestos para comparar distribuciones
par(mfrow = c(1, 2))

# Urbanas
hist(escuelas$presupuesto_anual_kusd[escuelas$tipo == "Urbana"],
     breaks = 15,
     col = rgb(1, 0.42, 0.42, 0.7),  # Rojo transparente
     border = "white",
     main = "DistribuciÃ³n: Escuelas Urbanas",
     xlab = "Presupuesto (kUSD)",
     ylab = "Frecuencia",
     xlim = c(0, 14))
abline(v = pres_urb, col = "darkred", lwd = 3)
abline(v = median(escuelas$presupuesto_anual_kusd[escuelas$tipo == "Urbana"]), 
       col = "darkred", lwd = 2, lty = 2)
legend("topright", legend = c("Media", "Mediana"), 
       col = "darkred", lty = c(1, 2), lwd = c(3, 2), bty = "n")

# Rurales
hist(escuelas$presupuesto_anual_kusd[escuelas$tipo == "Rural"],
     breaks = 12,
     col = rgb(0.31, 0.8, 0.77, 0.7),  # Turquesa transparente
     border = "white",
     main = "DistribuciÃ³n: Escuelas Rurales",
     xlab = "Presupuesto (kUSD)",
     ylab = "Frecuencia",
     xlim = c(0, 14))
abline(v = pres_rur, col = "darkblue", lwd = 3)
abline(v = median(escuelas$presupuesto_anual_kusd[escuelas$tipo == "Rural"]), 
       col = "darkblue", lwd = 2, lty = 2)
legend("topright", legend = c("Media", "Mediana"), 
       col = "darkblue", lty = c(1, 2), lwd = c(3, 2), bty = "n")

par(mfrow = c(1, 1))
```

**Pregunta:** Â¿La distribuciÃ³n del presupuesto es simÃ©trica o asimÃ©trica en cada grupo?

---

# Parte 8: Tabla de RendiciÃ³n de Cuentas

```{webr-r}
# Crear categorÃ­as de desempeÃ±o
escuelas$categoria_desempeno <- cut(
  escuelas$puntaje_prueba,
  breaks = c(0, 50, 70, 85, 100),
  labels = c("CrÃ­tico", "Bajo", "Aceptable", "Destacado"),
  include.lowest = TRUE
)

cat("\nğŸ¯ CLASIFICACIÃ“N DE ESCUELAS POR DESEMPEÃ‘O\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

# Tabla cruzada
tabla_desempeno <- table(escuelas$tipo, escuelas$categoria_desempeno)
print(tabla_desempeno)

cat("\n\nPorcentaje dentro de cada tipo:\n")
print(round(prop.table(tabla_desempeno, margin = 1) * 100, 1))

# Escuelas en situaciÃ³n crÃ­tica
criticas <- escuelas[escuelas$categoria_desempeno == "CrÃ­tico", ]
cat("\n\nğŸš¨ ESCUELAS EN SITUACIÃ“N CRÃTICA (< 50 puntos)\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("Total:", nrow(criticas), "escuelas\n\n")

if (nrow(criticas) > 0) {
  cat("Detalle de escuelas crÃ­ticas:\n")
  print(criticas[, c("id_escuela", "tipo", "puntaje_prueba", 
                     "presupuesto_anual_kusd")])
  
  cat("\n  Presupuesto promedio de escuelas crÃ­ticas: $",
      round(mean(criticas$presupuesto_anual_kusd), 2), "k USD\n")
  cat("  Â¿Es el presupuesto el problema o hay otros factores?\n")
}
```

---

# Parte 9: AuditorÃ­a de GrÃ¡ficos EngaÃ±osos

**Ejercicio de lectura crÃ­tica:** Imagina que ves este titular en un reporte:

> "Escuelas con mayor presupuesto tienen 15 puntos mÃ¡s en promedio - Â¡El dinero sÃ­ importa!"

```{webr-r}
# Comparemos dos formas de graficar la MISMA informaciÃ³n

par(mfrow = c(1, 2))

# GRÃFICO 1: Eje Y manipulado (empieza en 50, no en 0)
barplot(c(punt_urb, punt_rur),
        names.arg = c("Urbana", "Rural"),
        col = c("#FF6B6B", "#4ECDC4"),
        ylim = c(50, 80),  # NO empieza en 0
        main = "Â¿Enorme diferencia?",
        ylab = "Puntaje promedio")
text(0.7, punt_urb + 2, round(punt_urb, 1))
text(1.9, punt_rur + 2, round(punt_rur, 1))

# GRÃFICO 2: Eje Y correcto (empieza en 0)
barplot(c(punt_urb, punt_rur),
        names.arg = c("Urbana", "Rural"),
        col = c("#FF6B6B", "#4ECDC4"),
        ylim = c(0, 100),  # Empieza en 0
        main = "Diferencia en contexto",
        ylab = "Puntaje promedio")
text(0.7, punt_urb + 5, round(punt_urb, 1))
text(1.9, punt_rur + 5, round(punt_rur, 1))
abline(h = 60, col = "orange", lty = 2, lwd = 2)

par(mfrow = c(1, 1))
```

**Pregunta crÃ­tica:**
- Â¿CuÃ¡l grÃ¡fico exagera la diferencia?
- Â¿CuÃ¡l es mÃ¡s honesto?
- Â¿Por quÃ© importa la escala del eje Y?

**Reglas de auditorÃ­a de grÃ¡ficos:**
1. âœ… **Eje Y empieza en 0** (para barras)
2. âœ… **Denominador claro** (Â¿por estudiante? Â¿por escuela?)
3. âœ… **PoblaciÃ³n y periodo especificados**
4. âœ… **Muestra dispersiÃ³n** (no solo promedios)
5. âœ… **Declara limitaciones**

---

# Parte 10: Memo Ejecutivo con VisualizaciÃ³n

```{webr-r}
cat("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("  MEMO EJECUTIVO: ANÃLISIS DE DESEMPEÃ‘O ESCOLAR\n")
cat("  Para: Secretario de EducaciÃ³n\n")
cat("  Fecha:", format(Sys.Date(), "%d-%m-%Y"), "\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

cat("1. HALLAZGO PRINCIPAL\n\n")
cat("   Las escuelas urbanas tienen en promedio", round(pres_urb - pres_rur, 1),
    "k USD mÃ¡s de presupuesto\n")
cat("   pero solo", round(punt_urb - punt_rur, 1), 
    "puntos mÃ¡s de desempeÃ±o.\n\n")
cat("   â†’ El retorno marginal del presupuesto es MAYOR en escuelas rurales\n")
cat("     (", round(slope_rur, 2), " vs ", round(slope_urb, 2), 
    " puntos por kUSD)\n\n")

cat("2. ESCUELAS EN RIESGO\n\n")
cat("   â€¢", nrow(escuelas[escuelas$puntaje_prueba < 60, ]), 
    "escuelas estÃ¡n por debajo de la meta mÃ­nima (60 puntos)\n")
cat("   â€¢ De estas,", sum(escuelas$puntaje_prueba < 60 & escuelas$tipo == "Rural"),
    "son rurales\n")
cat("   â€¢ El", round(100 * nrow(criticas)/nrow(escuelas), 1),
    "% estÃ¡ en situaciÃ³n CRÃTICA (< 50 puntos)\n\n")

cat("3. DISPERSIÃ“N Y DESIGUALDAD\n\n")
cat("   â€¢ IQR Urbanas:", round(iqr_urb, 1), "puntos\n")
cat("   â€¢ IQR Rurales:", round(iqr_rur, 1), "puntos\n")
cat("   â†’ Mayor dispersiÃ³n en", 
    ifelse(iqr_urb > iqr_rur, "urbanas", "rurales"), "\n\n")

cat("4. RECOMENDACIONES BASADAS EN EVIDENCIA\n\n")
cat("   a) Priorizar inversiÃ³n en escuelas rurales de bajo desempeÃ±o\n")
cat("      (mayor retorno marginal del presupuesto)\n\n")
cat("   b) Auditar escuelas urbanas con alto presupuesto y bajo desempeÃ±o\n")
cat("      (posible problema de gestiÃ³n, no recursos)\n\n")
cat("   c) No usar solo presupuesto como palanca - el RÂ² es", 
    round(r2_urb, 2), "\n")
cat("      Considerar: capacitaciÃ³n docente, infraestructura, contexto\n\n")

cat("5. LIMITACIONES\n\n")
cat("   â€¢ CorrelaciÃ³n NO implica causalidad\n")
cat("   â€¢ No controlamos por: nivel socioeconÃ³mico, experiencia docente,\n")
cat("     infraestructura, tamaÃ±o de clase\n")
cat("   â€¢ Puntaje de prueba es solo un indicador de calidad educativa\n")
cat("   â€¢ No sabemos si escuelas con bajo presupuesto ya recibieron apoyos\n\n")

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Ejercicio Individual (Entregable)

**Parte A: Crear Visualizaciones**

1. **Boxplot comparativo:**
   - Grafica presupuesto_anual_kusd ~ tipo
   - Incluye tÃ­tulo-conclusiÃ³n (mÃ¡ximo 18 palabras)
   - Identifica outliers y explica quÃ© pueden representar

2. **Scatterplot con segmentaciÃ³n:**
   - Eje X: presupuesto, Eje Y: puntaje
   - Colorea puntos por tipo
   - Agrega lÃ­neas de tendencia
   - Marca escuelas con puntaje < 50 (cÃ­rculos rojos)

**Parte B: AnÃ¡lisis Escrito**

3. **Tabla de anÃ¡lisis:**
   Crea una tabla con 3 columnas:
   - Tipo de grÃ¡fico (Histograma, Boxplot, Scatterplot)
   - Pregunta que responde mejor
   - LimitaciÃ³n principal

4. **Ejercicio de lectura crÃ­tica:**
   Busca UN grÃ¡fico de un reporte real (puede ser de periÃ³dico, informe gubernamental, etc.)
   - Â¿Cumple las 5 reglas de auditorÃ­a?
   - Â¿Hay algo engaÃ±oso en la presentaciÃ³n?
   - Â¿QuÃ© mejorarÃ­as?

**Parte C: RecomendaciÃ³n EstratÃ©gica**

5. **Escribe 6 lÃ­neas respondiendo:**
   - Si solo puedes intervenir en 20 escuelas, Â¿cuÃ¡les eliges?
   - Â¿Usas criterio de presupuesto, desempeÃ±o, tipo, o combinaciÃ³n?
   - Incluye 1 limitaciÃ³n de tu propuesta

---

# Preguntas de DiscusiÃ³n

1. **La Trampa del Promedio Revisitada:**
   - Â¿Por quÃ© un grÃ¡fico de solo promedios puede ser engaÃ±oso?
   - Â¿QuÃ© se pierde cuando no mostramos dispersiÃ³n?

2. **Escalas Visuales:**
   - Â¿CuÃ¡ndo es legÃ­timo NO empezar el eje Y en cero?
   - Â¿QuÃ© riesgos tiene manipular las escalas?

3. **Denominadores:**
   - Â¿DeberÃ­amos graficar presupuesto total o por estudiante?
   - Â¿Puntaje promedio de escuela o distribuciÃ³n completa?

4. **Outliers:**
   - Â¿Los outliers son errores o informaciÃ³n valiosa?
   - Â¿CuÃ¡ndo deberÃ­as investigar un outlier vs. eliminarlo?

---

# Recursos Adicionales

**Principios de visualizaciÃ³n efectiva:**

1. **Claridad sobre estÃ©tica:** El grÃ¡fico debe comunicar, no impresionar
2. **Honestidad visual:** Escalas apropiadas, contexto completo
3. **DispersiÃ³n importa:** No solo promedios
4. **Comparaciones justas:** Mismo denominador, misma escala
5. **Contexto siempre:** PoblaciÃ³n, periodo, fuente, limitaciones

**Tipos de grÃ¡ficos y cuÃ¡ndo usarlos:**

- **Histograma:** Ver forma de distribuciÃ³n (asimetrÃ­a, modas)
- **Boxplot:** Comparar grupos, detectar outliers
- **Scatterplot:** Explorar relaciones entre dos variables
- **Barras:** Comparar cantidades (Â¡eje Y en 0!)
- **LÃ­neas:** Mostrar tendencias en el tiempo

**Errores comunes a evitar:**

- âŒ Solo mostrar promedios sin dispersiÃ³n
- âŒ Manipular escalas para exagerar diferencias
- âŒ No declarar denominador
- âŒ Graficar sin pregunta clara en mente
- âŒ Usar 3D, colores excesivos, "chart junk"

---

**Ãšltima reflexiÃ³n:** Un buen grÃ¡fico en polÃ­tica pÃºblica debe pasar la "prueba del ascensor": Â¿Puedes explicarlo en 30 segundos y cambiar una decisiÃ³n?
