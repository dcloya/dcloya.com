---
title: "SesiÃ³n 1: La TiranÃ­a del Promedio"
format: html
filters:
  - webr
---

# Caso de PolÃ­tica PÃºblica

Un municipio estÃ¡ diseÃ±ando un **programa de subsidios alimentarios** para hogares vulnerables. El informe tÃ©cnico reporta que el ingreso promedio per cÃ¡pita es de **$420 USD/mes**. El Secretario de Desarrollo Social propone establecer el umbral de elegibilidad en $250 USD/mes.

**Tu tarea:** Analizar la distribuciÃ³n de ingresos para determinar:
- Â¿CuÃ¡ntos hogares califican para el subsidio?
- Â¿El promedio representa bien a la poblaciÃ³n?
- Â¿Hay diferencias importantes entre zonas urbanas y rurales?

---

# Parte 1: Carga y ExploraciÃ³n de Datos

```{webr-r}
#| warning: false

# Cargar librerÃ­as
library(ggplot2)

# SimulaciÃ³n de datos municipales (5000 hogares)
set.seed(2026)
n_urbano <- 3000
n_rural <- 2000

# Zona urbana: distribuciÃ³n log-normal (cola larga)
# Hay algunos hogares de clase media-alta que inflan el promedio
ingreso_urbano <- rlnorm(n_urbano, meanlog = 5.8, sdlog = 0.65)

# Zona rural: distribuciÃ³n mÃ¡s concentrada pero con menor ingreso
ingreso_rural <- rlnorm(n_rural, meanlog = 5.3, sdlog = 0.50)

# Crear dataframe
datos <- data.frame(
  ingreso_pc_usd = c(ingreso_urbano, ingreso_rural),
  zona = c(rep("Urbana", n_urbano), rep("Rural", n_rural))
)

# Vista previa de los datos
head(datos, 10)
cat("\nğŸ“Š Total de hogares en la base:", nrow(datos), "\n")
```

**Pregunta de reflexiÃ³n:** Â¿Por quÃ© simulamos una distribuciÃ³n log-normal en vez de una normal? Â¿QuÃ© implica esto sobre la realidad del ingreso?

---

# Parte 2: EstadÃ­sticas Descriptivas BÃ¡sicas

```{webr-r}
# Calculemos el promedio que reporta el informe tÃ©cnico
promedio_general <- mean(datos$ingreso_pc_usd)
cat("ğŸ’° Ingreso promedio general: $", round(promedio_general, 2), "USD/mes\n\n")

# Pero... Â¿quÃ© nos dice la MEDIANA?
mediana_general <- median(datos$ingreso_pc_usd)
cat("ğŸ“ Ingreso mediano (hogar tÃ­pico): $", round(mediana_general, 2), "USD/mes\n\n")

# Diferencia entre media y mediana
diferencia <- promedio_general - mediana_general
cat("âš ï¸  Diferencia (media - mediana): $", round(diferencia, 2), "USD\n")
cat("    Esto representa un", round(100 * diferencia/mediana_general, 1), "% mÃ¡s\n\n")

# Â¿QuÃ© significa esta diferencia?
if (diferencia > 50) {
  cat("ğŸ”´ ALERTA: La distribuciÃ³n es ASIMÃ‰TRICA (cola larga a la derecha).\n")
  cat("   El promedio estÃ¡ inflado por hogares de altos ingresos.\n")
  cat("   La mediana es una mejor medida del hogar 'tÃ­pico'.\n")
}
```

**Para discutir:** Si el promedio es $420 pero la mediana es menor, Â¿quÃ© implica esto para el diseÃ±o del programa?

---

# Parte 3: AnÃ¡lisis por Percentiles (Las Colas Importan)

```{webr-r}
# Percentiles clave para polÃ­tica pÃºblica
percentiles <- quantile(datos$ingreso_pc_usd, 
                        probs = c(0.10, 0.25, 0.50, 0.75, 0.90))

cat("ğŸ“Š DISTRIBUCIÃ“N DE INGRESOS (Percentiles)\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("P10 (10% mÃ¡s pobre):     $", round(percentiles[1], 2), "\n")
cat("P25 (cuartil inferior):  $", round(percentiles[2], 2), "\n")
cat("P50 (mediana):           $", round(percentiles[3], 2), "\n")
cat("P75 (cuartil superior):  $", round(percentiles[4], 2), "\n")
cat("P90 (10% mÃ¡s rico):      $", round(percentiles[5], 2), "\n\n")

# Rango intercuartil (IQR): donde vive el 50% central
iqr <- IQR(datos$ingreso_pc_usd)
cat("ğŸ“ Rango Intercuartil (IQR): $", round(iqr, 2), "\n")
cat("   (Distancia entre P25 y P75)\n\n")

# DesviaciÃ³n estÃ¡ndar (dispersiÃ³n)
desv_std <- sd(datos$ingreso_pc_usd)
cat("ğŸ“ˆ DesviaciÃ³n EstÃ¡ndar: $", round(desv_std, 2), "\n")
cat("   (QuÃ© tanto se alejan los datos del promedio)\n\n")

# Coeficiente de variaciÃ³n (dispersiÃ³n relativa)
cv <- 100 * desv_std / promedio_general
cat("ğŸ¯ Coeficiente de VariaciÃ³n:", round(cv, 1), "%\n")
cat("   (> 30% indica alta heterogeneidad)\n")
```

**Ejercicio prÃ¡ctico:** 
1. Â¿QuÃ© porcentaje de hogares gana menos de $250/mes?
2. Â¿DeberÃ­amos usar P10 o P25 como criterio de elegibilidad?

---

# Parte 4: ComparaciÃ³n por Zona (Urbano vs Rural)

```{webr-r}
# Tabla comparativa completa
cat("\nğŸ“‹ TABLA COMPARATIVA: INGRESO POR ZONA\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat(sprintf("%-20s %12s %12s %12s\n", "EstadÃ­stica", "Urbana", "Rural", "Diferencia"))
cat("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n")

# Media
media_urb <- mean(datos$ingreso_pc_usd[datos$zona == "Urbana"])
media_rur <- mean(datos$ingreso_pc_usd[datos$zona == "Rural"])
cat(sprintf("%-20s $%10.2f $%10.2f $%10.2f\n", "Media", 
            media_urb, media_rur, media_urb - media_rur))

# Mediana
med_urb <- median(datos$ingreso_pc_usd[datos$zona == "Urbana"])
med_rur <- median(datos$ingreso_pc_usd[datos$zona == "Rural"])
cat(sprintf("%-20s $%10.2f $%10.2f $%10.2f\n", "Mediana", 
            med_urb, med_rur, med_urb - med_rur))

# P10
p10_urb <- quantile(datos$ingreso_pc_usd[datos$zona == "Urbana"], 0.10)
p10_rur <- quantile(datos$ingreso_pc_usd[datos$zona == "Rural"], 0.10)
cat(sprintf("%-20s $%10.2f $%10.2f $%10.2f\n", "P10 (mÃ¡s pobre)", 
            p10_urb, p10_rur, p10_urb - p10_rur))

# P90
p90_urb <- quantile(datos$ingreso_pc_usd[datos$zona == "Urbana"], 0.90)
p90_rur <- quantile(datos$ingreso_pc_usd[datos$zona == "Rural"], 0.90)
cat(sprintf("%-20s $%10.2f $%10.2f $%10.2f\n", "P90 (mÃ¡s rico)", 
            p90_urb, p90_rur, p90_urb - p90_rur))

# IQR
iqr_urb <- IQR(datos$ingreso_pc_usd[datos$zona == "Urbana"])
iqr_rur <- IQR(datos$ingreso_pc_usd[datos$zona == "Rural"])
cat(sprintf("%-20s $%10.2f $%10.2f $%10.2f\n", "IQR (dispersiÃ³n)", 
            iqr_urb, iqr_rur, iqr_urb - iqr_rur))

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

**InterpretaciÃ³n clave:**
- Â¿En quÃ© zona hay mayor desigualdad interna?
- Â¿DeberÃ­an ser diferentes los criterios de elegibilidad por zona?

---

# Parte 5: VisualizaciÃ³n 1 - Histograma

```{webr-r}
# Histograma general con lÃ­neas de referencia
hist(datos$ingreso_pc_usd, 
     breaks = 40, 
     col = "steelblue", 
     border = "white",
     main = "DistribuciÃ³n de Ingresos Per CÃ¡pita",
     xlab = "Ingreso mensual (USD)",
     ylab = "Frecuencia de hogares",
     xlim = c(0, 1500))

# LÃ­nea vertical: media (promedio)
abline(v = promedio_general, col = "red", lwd = 3, lty = 1)
# LÃ­nea vertical: mediana
abline(v = mediana_general, col = "darkgreen", lwd = 3, lty = 2)
# LÃ­nea vertical: umbral de elegibilidad propuesto
abline(v = 250, col = "orange", lwd = 2, lty = 3)

# Leyenda
legend("topright", 
       legend = c("Media ($420)", "Mediana", "Umbral ($250)"),
       col = c("red", "darkgreen", "orange"),
       lty = c(1, 2, 3),
       lwd = c(3, 3, 2),
       bty = "n")

# Agregar texto explicativo
text(900, max(hist(datos$ingreso_pc_usd, plot=F, breaks=40)$counts) * 0.8,
     "Cola larga â†’\nAlgunos hogares\nde altos ingresos\ninflan el promedio",
     pos = 4, col = "red", cex = 0.9)
```

**Pregunta de anÃ¡lisis:** Â¿QuÃ© nos dice la forma de este histograma sobre la distribuciÃ³n del ingreso?

---

# Parte 6: VisualizaciÃ³n 2 - Boxplot Comparativo

```{webr-r}
# Boxplot lado a lado
boxplot(ingreso_pc_usd ~ zona, 
        data = datos,
        col = c("coral", "lightgreen"),
        main = "ComparaciÃ³n de Ingresos: Urbano vs Rural",
        ylab = "Ingreso per cÃ¡pita (USD/mes)",
        xlab = "Zona",
        horizontal = FALSE,
        notch = FALSE,
        outcol = "red",
        outpch = 19,
        outcex = 0.5)

# LÃ­nea de referencia: umbral de elegibilidad
abline(h = 250, col = "blue", lwd = 2, lty = 2)

# Agregar anotaciones sobre los elementos del boxplot
mtext("LÃ­nea central = Mediana", side = 3, line = -2, at = 1, cex = 0.8, col = "gray30")
mtext("Caja = IQR (50% central)", side = 3, line = -3, at = 1, cex = 0.8, col = "gray30")
mtext("Bigotes = Rango esperado", side = 3, line = -4, at = 1, cex = 0.8, col = "gray30")
mtext("Puntos = Outliers", side = 3, line = -5, at = 1, cex = 0.8, col = "red")
```

**Elementos del boxplot:**
- **LÃ­nea central:** mediana (P50)
- **Caja:** contiene el 50% central de los datos (P25 a P75)
- **Bigotes:** se extienden hasta 1.5Ã—IQR
- **Puntos rojos:** valores atÃ­picos (outliers)

---

# Parte 7: AnÃ¡lisis de Elegibilidad

```{webr-r}
# Â¿CuÃ¡ntos hogares califican con el umbral de $250?
umbral <- 250
elegibles <- sum(datos$ingreso_pc_usd < umbral)
pct_elegibles <- 100 * elegibles / nrow(datos)

cat("\nğŸ¯ ANÃLISIS DE ELEGIBILIDAD\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("Umbral propuesto:    $", umbral, "USD/mes\n\n")
cat("Hogares elegibles:   ", elegibles, "\n")
cat("Porcentaje total:    ", round(pct_elegibles, 1), "%\n\n")

# Por zona
elegibles_urb <- sum(datos$ingreso_pc_usd[datos$zona == "Urbana"] < umbral)
elegibles_rur <- sum(datos$ingreso_pc_usd[datos$zona == "Rural"] < umbral)

pct_urb <- 100 * elegibles_urb / n_urbano
pct_rur <- 100 * elegibles_rur / n_rural

cat("Zona Urbana:         ", elegibles_urb, " hogares (", round(pct_urb, 1), "%)\n")
cat("Zona Rural:          ", elegibles_rur, " hogares (", round(pct_rur, 1), "%)\n\n")

# ComparaciÃ³n con diferentes umbrales
umbrales <- c(200, 250, 300, p10_urb, med_rur)
nombres_umbrales <- c("$200 (restrictivo)", "$250 (propuesto)", "$300 (amplio)", 
                      "P10 urbano", "Mediana rural")

cat("ğŸ“Š SENSIBILIDAD DEL UMBRAL\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
for (i in 1:length(umbrales)) {
  n_elegibles <- sum(datos$ingreso_pc_usd < umbrales[i])
  pct <- 100 * n_elegibles / nrow(datos)
  cat(sprintf("%-20s: %4d hogares (%5.1f%%)\n", 
              nombres_umbrales[i], n_elegibles, pct))
}
```

**Pregunta de polÃ­tica:**
- Â¿QuÃ© umbral recomendarÃ­as y por quÃ©?
- Â¿CÃ³mo balanceas cobertura vs. recursos disponibles?

---

# Parte 8: Tabla Resumen para Memo Ejecutivo

```{webr-r}
# Crear tabla profesional para presentar al Secretario
cat("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("  RESUMEN EJECUTIVO: DISTRIBUCIÃ“N DE INGRESOS MUNICIPAL\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

cat("1. PANORAMA GENERAL\n")
cat("   â€¢ Total de hogares:              5,000\n")
cat("   â€¢ Ingreso promedio:              $", round(promedio_general, 2), " USD/mes\n")
cat("   â€¢ Ingreso MEDIANO (tÃ­pico):      $", round(mediana_general, 2), " USD/mes\n")
cat("   â€¢ Diferencia media-mediana:      +", round(diferencia, 2), " USD (", 
    round(100*diferencia/mediana_general, 1), "%)\n\n")

cat("2. ANÃLISIS POR PERCENTILES\n")
cat("   â€¢ 10% mÃ¡s pobre (P10):           < $", round(percentiles[1], 2), "\n")
cat("   â€¢ 25% inferior (P25):            < $", round(percentiles[2], 2), "\n")
cat("   â€¢ 50% inferior (Mediana):        < $", round(percentiles[3], 2), "\n")
cat("   â€¢ 25% superior (P75):            > $", round(percentiles[4], 2), "\n")
cat("   â€¢ 10% mÃ¡s rico (P90):            > $", round(percentiles[5], 2), "\n\n")

cat("3. DISPERSIÃ“N Y DESIGUALDAD\n")
cat("   â€¢ Rango intercuartil (IQR):      $", round(iqr, 2), "\n")
cat("   â€¢ DesviaciÃ³n estÃ¡ndar:           $", round(desv_std, 2), "\n")
cat("   â€¢ Coeficiente de variaciÃ³n:      ", round(cv, 1), "%\n\n")

cat("4. COMPARACIÃ“N URBANO-RURAL\n")
cat("   â€¢ Mediana urbana:                $", round(med_urb, 2), "\n")
cat("   â€¢ Mediana rural:                 $", round(med_rur, 2), "\n")
cat("   â€¢ Brecha:                        $", round(med_urb - med_rur, 2), "\n\n")

cat("5. ELEGIBILIDAD (Umbral $250)\n")
cat("   â€¢ Hogares elegibles TOTAL:       ", elegibles, " (", round(pct_elegibles, 1), "%)\n")
cat("   â€¢ Elegibles zona urbana:         ", elegibles_urb, " (", round(pct_urb, 1), "%)\n")
cat("   â€¢ Elegibles zona rural:          ", elegibles_rur, " (", round(pct_rur, 1), "%)\n\n")

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Parte 9: RecomendaciÃ³n Basada en Evidencia

```{webr-r}
cat("\nğŸ’¡ RECOMENDACIÃ“N PARA EL SECRETARIO\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

cat("ğŸ“Œ HALLAZGO PRINCIPAL:\n")
cat("El ingreso promedio de $420 USD/mes NO representa al hogar tÃ­pico.\n")
cat("La distribuciÃ³n es altamente asimÃ©trica con cola larga a la derecha.\n")
cat("El hogar mediano gana $", round(mediana_general, 2), " USD/mes, ", 
    round(100 * diferencia/promedio_general, 1), "% menos que el promedio.\n\n")

cat("ğŸ¯ IMPLICACIONES PARA POLÃTICA:\n")
cat("1. Usar el PROMEDIO como referencia subestimarÃ­a la vulnerabilidad.\n")
cat("2. Con umbral de $250, se cubre al ", round(pct_elegibles, 1), "% de hogares.\n")
cat("3. Existe desigualdad significativa entre zonas (CV = ", round(cv, 1), "%).\n\n")

cat("âœ… RECOMENDACIONES:\n")
cat("1. Considerar umbrales diferenciados por zona:\n")
cat("   - Zona urbana: P25 = $", round(quantile(datos$ingreso_pc_usd[datos$zona=="Urbana"], 0.25), 2), "\n")
cat("   - Zona rural:  P25 = $", round(quantile(datos$ingreso_pc_usd[datos$zona=="Rural"], 0.25), 2), "\n\n")

cat("2. Focalizar en el P10-P25 para maximizar impacto en pobreza extrema.\n\n")

cat("3. Monitorear la cola superior (P90+) para posibles exclusiones.\n\n")

cat("âš ï¸  LIMITACIONES:\n")
cat("â€¢ Estos datos NO incluyen ingresos informales (probable subestimaciÃ³n)\n")
cat("â€¢ No considera composiciÃ³n del hogar (per cÃ¡pita vs hogar total)\n")
cat("â€¢ La muestra puede tener sesgo de selecciÃ³n si hay no-respuesta diferencial\n")
cat("â€¢ No captura variabilidad temporal (ingreso en un solo mes)\n\n")

cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
```

---

# Ejercicio Individual (Entregable)

**Instrucciones:**

1. **Crea una tabla** comparando las siguientes estadÃ­sticas para zona urbana vs rural:
   - Media, Mediana, P10, P90, IQR
   - Interpreta: Â¿DÃ³nde hay mayor desigualdad interna?

2. **Genera un histograma** del ingreso solo para zona rural:
   - Incluye lÃ­neas de referencia (media, mediana, umbral)
   - Escribe un tÃ­tulo-conclusiÃ³n de mÃ¡ximo 18 palabras

3. **PropÃ³n un criterio de elegibilidad** basado en percentiles:
   - Justifica tu elecciÃ³n en 6 lÃ­neas
   - Incluye al menos 1 limitaciÃ³n de tu propuesta
   - Evita usar "promedio" como criterio Ãºnico

4. **Responde:**
   - Â¿QuÃ© riesgo operativo implica usar solo el promedio para diseÃ±ar polÃ­tica?
   - Â¿Por quÃ© importa ver la "cola" de la distribuciÃ³n (P10 y P90)?

---

# Preguntas de DiscusiÃ³n

1. **FocalizaciÃ³n vs Universalidad:** Si tuvieras presupuesto para solo el 20% mÃ¡s pobre, Â¿usarÃ­as P10 o P20 como corte? Â¿Por quÃ©?

2. **Denominador:** Â¿DeberÃ­a calcularse el ingreso per cÃ¡pita o por hogar? Â¿QuÃ© cambia?

3. **Errores de inclusiÃ³n/exclusiÃ³n:** Â¿PreferirÃ­as un umbral que excluya a algunos elegibles (error tipo II) o que incluya a algunos no elegibles (error tipo I)?

4. **Evidencia incompleta:** Si no tienes datos de ingreso informal, Â¿cÃ³mo afecta esto tu recomendaciÃ³n? Â¿SerÃ­as mÃ¡s conservador o mÃ¡s agresivo con el umbral?

---

# Recursos Adicionales

**Conceptos clave para recordar:**

- **Media vs Mediana:** En distribuciones asimÃ©tricas, la mediana es mÃ¡s robusta
- **Percentiles:** Lenguaje para describir posiciones en la distribuciÃ³n
- **IQR:** Mide dispersiÃ³n sin ser afectado por outliers
- **Coeficiente de VariaciÃ³n:** DispersiÃ³n relativa (> 30% = alta heterogeneidad)
- **Histograma:** Muestra la forma completa de la distribuciÃ³n
- **Boxplot:** Ideal para comparar grupos y detectar outliers

**Para profundizar:**
- Busca "Anscombe's Quartet" para ver por quÃ© siempre hay que visualizar
- Lee sobre "Simpson's Paradox" (lo veremos en sesiÃ³n 10)
- Investiga cÃ³mo se calcula la lÃ­nea de pobreza en tu paÃ­s

---

**Ãšltima reflexiÃ³n:** En polÃ­tica pÃºblica, un solo nÃºmero (el promedio) puede ocultar mÃ¡s de lo que revela. La distribuciÃ³n completa importa.
