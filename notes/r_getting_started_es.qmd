---
title: "Secci√≥n 1: Introducci√≥n a R"
author: "David Contreras-Loya"
date: today
format: 
  html:
    toc: true
    toc-depth: 3
    code-fold: false
    code-tools: true
    theme: cosmo
    df-print: paged
---

# Lo que necesitar√°s

1. Instalaciones funcionales y actualizadas de **R** y **RStudio**
2. Una conexi√≥n a internet (para instalar paquetes)
3. *Opcional:* Una fuente saludable de cafe√≠na ‚òï

# Resumen

En esta secci√≥n nos sumergiremos en R. Comenzamos instalando y cargando paquetes √∫tiles (`dplyr` y `pacman`). Luego cargamos el dataset cl√°sico `iris` y comenzamos a resumirlo y manipularlo. Finalmente, haremos nuestras primeras gr√°ficas.

---

# Paquetes en R

Abre RStudio. Aseg√∫rate de estar ejecutando las versiones m√°s recientes de R y RStudio.

::: {.callout-important}
## Verifica tus versiones
- **Versi√≥n de R**: 4.4.2 o m√°s reciente
- **Versi√≥n de RStudio**: 2024.12.0 o m√°s reciente
:::

Aunque R base es √∫til y poderoso, el verdadero potencial de R proviene de combinar la instalaci√≥n principal con los muchos paquetes generados a trav√©s de la colaboraci√≥n de c√≥digo abierto (ver [lista de paquetes de CRAN](https://cran.r-project.org/web/packages/available_packages_by_name.html)).

## Instalaci√≥n de paquetes

Puedes verificar qu√© paquetes est√°n instalados actualmente usando la funci√≥n `installed.packages()`. ¬øListo para ejecutar tu primera funci√≥n? Escribe `installed.packages()` en la consola de R y presiona enter.

::: {.callout-tip}
## Alternativa: Verifica la pesta√±a Packages
Tambi√©n puedes verificar la pesta√±a **Packages** dentro de RStudio. Las casillas marcadas indican los paquetes que est√°n actualmente cargados.
:::

Ahora, instalemos algunos paquetes que ser√°n √∫tiles este semestre. Usamos la funci√≥n `install.packages()`, d√°ndole el nombre(s) del paquete(s) que deseas instalar.

```{r}
#| eval: false

# Instalar el paquete llamado "dplyr"
install.packages("dplyr")

# Instalar m√∫ltiples paquetes a la vez
install.packages(c("dplyr", "ggplot2"))
```

### Notas importantes:

0. **Necesitas una conexi√≥n a internet.**
1. El nombre de la funci√≥n `install.packages()` es plural independientemente del n√∫mero de paquetes.
2. El nombre de cada paquete est√° rodeado de **comillas** (*ej.*, `"dplyr"`). Estas comillas le dicen a R que esto es un car√°cter/cadena, no un objeto. Usa **comillas dobles** para consistencia.
3. Podemos crear un **vector** de paquetes usando `c()`. Ejemplo: `c(1, 2, 3)` es un vector de tres elementos. De manera similar, `c("dplyr", "ggplot2")` es un vector de dos elementos con nombres de paquetes. **Los vectores son muy importantes en R.**
4. El s√≠mbolo de n√∫mero (`#`) crea **comentarios** en R.

## Carga de paquetes

Para verificar que las instalaciones fueron exitosas, cargaremos los paquetes usando la funci√≥n `library()`:

```{r}
#| eval: false

library(dplyr)
library(ggplot2)
```

::: {.callout-note}
Nota que no necesitamos comillas alrededor de los nombres de los paquetes al cargarlos (aunque a√∫n funcionar√≠a con comillas).
:::

## Gesti√≥n de paquetes con `pacman`

Instalemos otro paquete: el paquete `pacman` (¬°s√≠, como el juego! üéÆ).

```{r}
#| eval: false

# Instalar el paquete 'pacman'
install.packages("pacman")

# Cargarlo
library(pacman)
```

El paquete `pacman` es muy meta: es un paquete para gestionar paquetes. Puedes usarlo para instalar, cargar, descargar y actualizar tus paquetes de R.

En lugar de escribir `library(...)` para cada paquete, usa la funci√≥n `p_load()` de `pacman`:

```{r}
#| eval: false

# Forma antigua
library(dplyr)
library(ggplot2)

# Forma nueva
p_load(dplyr, ggplot2)
```

**A√∫n mejor:** Si intentas cargar un paquete que no est√° instalado, ¬°`p_load()` lo instalar√° autom√°ticamente! 

```{r}
#| eval: false

# Esto instalar√° y cargar√° tidyr si no est√° instalado
p_load(tidyr)
```

Instalado y cargado. ¬°*Ese* es servicio! ‚ú®

---

# Carga de datos

## El dataset Iris

El dataset **Iris** contiene mediciones de 150 flores de iris de tres especies diferentes (*Iris setosa*, *Iris versicolor*, e *Iris virginica*). Para cada flor se registraron cuatro caracter√≠sticas: la longitud y ancho del s√©palo, y la longitud y ancho del p√©talo (todas en cent√≠metros).

Este conjunto de datos fue introducido por el estad√≠stico y bi√≥logo Ronald Fisher en 1936 y se ha convertido en un cl√°sico para ense√±ar an√°lisis estad√≠stico, clasificaci√≥n y visualizaci√≥n de datos. Es uno de los datasets m√°s utilizados en la ense√±anza de ciencia de datos por su simplicidad, claridad y utilidad pedag√≥gica.

## Carga de datasets incluidos en R

Una de las ventajas de R es que viene con varios datasets incorporados que podemos usar para practicar. El dataset `iris` es uno de ellos.

Para cargar un dataset incorporado, usa la funci√≥n `data()`:

```{r}
#| eval: false

# Cargar el dataset iris
data(iris)
```

::: {.callout-tip}
## ¬øQu√© datasets est√°n disponibles?
Para ver todos los datasets incorporados en R, escribe:
```{r}
#| eval: false

data()
```
:::

::: {.callout-important}
## El operador de asignaci√≥n `<-`
Aunque `iris` ya est√° disponible despu√©s de usar `data(iris)`, a menudo queremos crear una copia para trabajar con ella. El operador `<-` es central en R. Asigna el(los) valor(es) de la derecha al nombre de la izquierda. 

Al leer en voz alta, la gente dice "obtiene": `flores` **obtiene** el contenido de `iris`.

```{r}
#| eval: false

# Crear una copia del dataset
flores <- iris
```
:::

Para ver los datos, simplemente escribe su nombre:

```{r}
#| eval: false

iris
```

## Funciones para cargar archivos externos

Cuando trabajes con tus propios datos, necesitar√°s cargar archivos desde tu computadora. Principalmente usar√°s:

- **Paquete `readr`**: para archivos CSV, TSV y delimitados
- **Paquete `haven`**: para archivos de Stata (`.dta`), SPSS y SAS
- **R base**: para los formatos propios de R (`.rds`, `.rdata`)

::: {.callout-tip}
## Aprende sobre las funciones
Para aprender m√°s sobre una funci√≥n:

1. Presiona **Tab** despu√©s de escribir el nombre de la funci√≥n (en RStudio)
2. Escribe `?function_name` en la consola (*ej.*, `?read.csv`)
:::

### Ejemplo: Cargar un archivo CSV

```{r}
#| eval: false

# Si tuvieras un archivo CSV
library(readr)
mis_datos <- read_csv("ruta/a/mi_archivo.csv")
```

---

# Jugando con datos

Ahora que tenemos el dataset `iris` cargado, ¬°hagamos algo con esos datos!

## Exploraci√≥n de los datos

Imprime los datos en la consola:

```{r}
#| eval: false

iris
```

Nota varias cosas:

1. El conjunto de datos es un **data frame** (la estructura b√°sica de R para datos tabulares)
2. Dimensiones: 150 filas √ó 5 columnas
3. Tipos de columnas: num√©ricas (`Sepal.Length`, `Sepal.Width`, `Petal.Length`, `Petal.Width`) y factor (`Species`)
4. Obtienes una vista de los primeros registros

### Obtener nombres de columnas

```{r}
#| eval: false

names(iris)
```

### Ver primeras/√∫ltimas filas

```{r}
#| eval: false

# Primeras 6 filas
head(iris)

# Primeras 10 filas
head(iris, n = 10)

# √öltimas 7 filas
tail(iris, n = 7)
```

::: {.callout-tip}
## Visor de datos de RStudio
Usa `View(iris)` o haz clic en el conjunto de datos en el panel Environment para abrir el visor de datos de RStudio.
:::

### Estructura del dataset

```{r}
#| eval: false

# Ver estructura detallada
str(iris)
```

Esto te mostrar√°:
- El tipo de objeto (data.frame)
- N√∫mero de observaciones y variables
- Nombre y tipo de cada variable
- Los primeros valores de cada variable

## Resumen de los datos

Obt√©n un resumen r√°pido de tu conjunto de datos:

```{r}
#| eval: false

summary(iris)
```

Esto te dar√° estad√≠sticas descriptivas para cada variable:
- Para variables num√©ricas: m√≠nimo, 1er cuartil, mediana, media, 3er cuartil, m√°ximo
- Para factores: conteo de cada categor√≠a

Para resumir una **variable √∫nica**, usa `$` para tomarla:

```{r}
#| eval: false

# Tomar la variable Sepal.Length
iris$Sepal.Length

# Resumir Sepal.Length
summary(iris$Sepal.Length)

# Otras funciones √∫tiles
mean(iris$Sepal.Length)    # Media
median(iris$Sepal.Length)  # Mediana
sd(iris$Sepal.Length)      # Desviaci√≥n est√°ndar
min(iris$Sepal.Length)     # M√≠nimo
max(iris$Sepal.Length)     # M√°ximo
```

::: {.callout-tip}
## Acceso a variables
`dataset$variable` es c√≥mo tomas una columna espec√≠fica. ¬°El autocompletado de pesta√±as de RStudio tambi√©n funciona aqu√≠!
:::

## Manipulaci√≥n de los datos

El paquete `dplyr` ofrece herramientas √∫tiles para manipulaci√≥n de datos usando **verbos** como acciones.

### `select()` - Elegir variables

Mant√©n solo las variables que te interesan:

```{r}
#| eval: false

# Cargar dplyr
library(dplyr)

# Seleccionar solo mediciones del s√©palo y especie
iris_sepalos <- select(iris, Sepal.Length, Sepal.Width, Species)

# Ver resultado
iris_sepalos
```

¬°Ahora tenemos 150 filas pero solo 3 columnas!

**Alternativa:** Excluir variables con un signo menos:

```{r}
#| eval: false

# Todo excepto las mediciones de p√©talos
select(iris, -Petal.Length, -Petal.Width)
```

### `arrange()` - Ordenar datos

Ordena los datos por una o m√°s columnas:

```{r}
#| eval: false

# Ordenar por longitud de s√©palo
arrange(iris, Sepal.Length)

# Ordenar por especie, luego por longitud de s√©palo
arrange(iris, Species, Sepal.Length)
```

::: {.callout-warning}
## ¬°Se requiere asignaci√≥n!
Si ves `iris` ahora, no est√° ordenado. Debes **asignar** el resultado para cambiar el objeto:

```{r}
#| eval: false

iris_ordenado <- arrange(iris, Sepal.Length)
```
:::

Para orden **descendente**, usa `desc()`:

```{r}
#| eval: false

# Flores con s√©palos m√°s largos primero
arrange(iris, desc(Sepal.Length))
```

### `filter()` - Filtrar filas

Mant√©n solo las filas que cumplan ciertas condiciones:

```{r}
#| eval: false

# Solo flores setosa
filter(iris, Species == "setosa")

# Flores con s√©palos largos (> 6 cm)
filter(iris, Sepal.Length > 6)

# Setosa con s√©palos largos
filter(iris, Species == "setosa", Sepal.Length > 5)
```

### `summarize()` - Crear res√∫menes

Crea res√∫menes espec√≠ficos de tus datos:

```{r}
#| eval: false

# Media y DE de longitud de s√©palo
summarize(iris, 
          media = mean(Sepal.Length), 
          de = sd(Sepal.Length))

# M√∫ltiples estad√≠sticas
summarize(iris,
          n_flores = n(),
          media_sepalo = mean(Sepal.Length),
          media_petalo = mean(Petal.Length),
          max_sepalo = max(Sepal.Length))
```

### `group_by()` - Agrupar datos

Combina `group_by()` con `summarize()` para an√°lisis por grupos:

```{r}
#| eval: false

# Estad√≠sticas por especie
iris %>%
  group_by(Species) %>%
  summarize(
    n = n(),
    media_sepalo = mean(Sepal.Length),
    media_petalo = mean(Petal.Length)
  )
```

::: {.callout-note}
## El operador pipe `%>%`
El operador `%>%` (pipe) te permite encadenar operaciones. Se lee como "luego". En este ejemplo: "toma iris, **luego** agrupa por especie, **luego** resume". Cubriremos esto m√°s a fondo en la Secci√≥n 2.
:::

## Gr√°ficas de los datos

Las funciones de gr√°ficas predeterminadas de R son simples pero efectivas. Cubriremos `ggplot2` m√°s adelante, pero por ahora, hagamos gr√°ficas r√°pidas.

### Histograma

Crea un histograma de longitud de s√©palo:

```{r}
#| eval: false

# Histograma simple
hist(iris$Sepal.Length)
```

Hazlo m√°s bonito con etiquetas y una l√≠nea en la media:

```{r}
#| eval: false

# El histograma
hist(
  x = iris$Sepal.Length,
  main = "Distribuci√≥n de longitud de s√©palo",
  xlab = "Longitud de s√©palo (cm)",
  ylab = "Frecuencia",
  col = "lightblue",
  breaks = 15
)

# Agregar l√≠nea roja en la media
abline(v = mean(iris$Sepal.Length), col = "red", lwd = 3, lty = 2)
```

### Gr√°fica de dispersi√≥n

Grafica la relaci√≥n entre longitud de s√©palo y longitud de p√©talo:

```{r}
#| eval: false

plot(
  x = iris$Sepal.Length,
  y = iris$Petal.Length,
  xlab = "Longitud de s√©palo (cm)",
  ylab = "Longitud de p√©talo (cm)",
  main = "Relaci√≥n entre s√©palo y p√©talo",
  pch = 19,        # Tipo de punto
  col = "blue"     # Color
)
```

### Gr√°fica por grupos

Colorea los puntos seg√∫n la especie:

```{r}
#| eval: false

# Convertir especies a n√∫meros para colores
colores <- as.numeric(iris$Species)

plot(
  x = iris$Sepal.Length,
  y = iris$Petal.Length,
  xlab = "Longitud de s√©palo (cm)",
  ylab = "Longitud de p√©talo (cm)",
  main = "Relaci√≥n s√©palo-p√©talo por especie",
  pch = 19,
  col = colores
)

# Agregar leyenda
legend("topleft", 
       legend = levels(iris$Species),
       col = 1:3,
       pch = 19)
```

### Boxplot

Compara distribuciones entre especies:

```{r}
#| eval: false

boxplot(Sepal.Length ~ Species, 
        data = iris,
        main = "Longitud de s√©palo por especie",
        xlab = "Especie",
        ylab = "Longitud de s√©palo (cm)",
        col = c("lightgreen", "lightblue", "lightpink"))
```

::: {.callout-tip}
## Estilo de c√≥digo claro
Recomiendo definir claramente los argumentos de funci√≥n. Ayuda a mantener las cosas claras, ya que **el orden importa** cuando no est√°s nombrando los argumentos.
:::

---

# Indexaci√≥n

Casi todo en R est√° indexado num√©ricamente. Puedes acceder a elementos individuales usando **corchetes** `[]`.

## Indexaci√≥n de vectores

```{r}
#| eval: false

# Crear un vector
x <- c(3, 5, 7, 9)

# Tomar el segundo elemento
x[2]  # Devuelve: 5

# Tomar segundo y tercer elementos
x[c(2, 3)]  # Devuelve: 5 7
x[2:3]      # Mismo resultado

# ¬øQu√© hace 2:3?
2:3  # Crea secuencia: 2 3

# ¬øY 1:10?
1:10  # Crea secuencia de 1 a 10
```

## Indexaci√≥n de data frames

Los data frames tienen **filas y columnas**: `[fila, columna]`

```{r}
#| eval: false

# Tomar primera fila (todas las columnas)
iris[1, ]

# Tomar primera columna (todas las filas)
iris[, 1]

# Tomar primeras 5 filas, primeras 3 columnas
iris[1:5, 1:3]

# Usar nombre de columna como √≠ndice
iris[1:10, "Species"]

# Combinar: primeras 10 filas de setosa
iris[iris$Species == "setosa", ][1:10, ]
```

::: {.callout-note}
## Orden fila, columna
Recuerda: **Filas antes de columnas**. Deja en blanco para seleccionar todo.
- `[1, ]` = primera fila, todas las columnas
- `[, 2]` = todas las filas, segunda columna
- `[3, 4]` = tercera fila, cuarta columna
:::

---

# Desaf√≠o divertido

::: {.callout-note icon="false"}
## Prueba esto
1. ¬øQu√© sucede si le das a `head()` o `tail()` un `n` **negativo**?
2. ¬øPuedes replicar este comportamiento usando indexaci√≥n?
3. ¬øPuedes obtener todas las flores *excepto* las primeras 10 usando `head()`?
4. ¬øCu√°ntas flores de cada especie hay en el dataset? (Pista: usa `table()`)
:::

---

# Problemas de pr√°ctica

## Problemas con el dataset Iris

::: {.callout-tip icon="false"}
## Problema 1: An√°lisis descriptivo
Usando el dataset `iris`:

1. Calcula la media y desviaci√≥n est√°ndar de `Petal.Length`
2. ¬øCu√°l es la flor con el p√©talo m√°s largo? (Pista: usa `which.max()`)
3. Crea un subset con solo flores versicolor
4. ¬øCu√°l es la media de `Sepal.Width` para flores versicolor?
:::

::: {.callout-tip icon="false"}
## Problema 2: Manipulaci√≥n de datos
1. Crea un nuevo data frame con solo flores que tengan `Sepal.Length > 5`
2. Ordena este nuevo data frame por `Petal.Length` en orden descendente
3. Selecciona solo las columnas de mediciones de p√©talos y especie
4. ¬øCu√°ntas filas tiene tu resultado final?
:::

## Problemas de √°lgebra lineal

Algunos rompecabezas cl√°sicos de R-encuentra-√°lgebra-lineal para tu disfrute:

::: {.callout-tip icon="false"}
## Problema 3: Matriz identidad
Sea **I**‚ÇÖ una matriz identidad de 5√ó5. Demuestra que **I**‚ÇÖ es sim√©trica e idempotente usando funciones de R.

**Pista:** Usa `diag(5)` para crear una matriz identidad.
:::

::: {.callout-tip icon="false"}
## Problema 4: Matriz idempotente
Genera una matriz idempotente de 2√ó2 **X**, donde **X** no es la matriz identidad. Demuestra que **X** = **XX**.

**Pista:** Una matriz idempotente satisface **X** = **X**¬≤.
:::

::: {.callout-tip icon="false"}
## Problema 5: Regresi√≥n lineal
Genera dos variables aleatorias, **x** y **e**, de dimensi√≥n n = 100 tal que **x**, **e** ~ N(0, 1).

Genera **y** de acuerdo a: y = x + e

Muestra que regresar **y** sobre **x** usando `lm()` da estimaciones: Œ≤‚ÇÄ ‚âà 0 y Œ≤‚ÇÅ ‚âà 1.

**Pista:** Usa `rnorm(100)` para generar variables aleatorias normales.
:::

::: {.callout-tip icon="false"}
## Problema 6: Valores propios y traza
Muestra que si Œª‚ÇÅ, Œª‚ÇÇ, ..., Œª‚ÇÖ son los valores propios de una matriz de 5√ó5 **A**, entonces:

tr(**A**) = Œ£Œª·µ¢ (suma de valores propios)

**Pista:** Usa `eigen()` para encontrar valores propios y `sum(diag())` para la traza.
:::

---

# Puntos clave

::: {.callout-important icon="true"}
## Recuerda

1. **Los paquetes extienden el poder de R** - Usa `pacman::p_load()` para gesti√≥n f√°cil
2. **Datasets incorporados** - R incluye datasets como `iris` para practicar
3. **La asignaci√≥n es clave** - Usa `<-` para guardar resultados: `new_data <- old_data`
4. **Verbos de `dplyr`** - `select()`, `filter()`, `arrange()`, `summarize()`, `group_by()` para manipulaci√≥n de datos
5. **Indexaci√≥n con `[fila, columna]`** - Esencial para acceder a datos
6. **Usa `$` para columnas** - `dataset$variable` toma una variable espec√≠fica
7. **Funciones de resumen** - `summary()`, `str()`, `head()`, `tail()` para exploraci√≥n
:::

---

# Recursos adicionales

- [R for Data Science](https://r4ds.hadley.nz/) - Gu√≠a completa
- [Hojas de referencia de RStudio](https://posit.co/resources/cheatsheets/) - Referencias r√°pidas
- [Stack Overflow](https://stackoverflow.com/questions/tagged/r) - Comunidad de preguntas y respuestas
- `?function_name` - Ayuda integrada de R
- `?iris` - Documentaci√≥n del dataset iris

---

**Siguiente:** Secci√≥n 2 - Manipulaci√≥n de datos con dplyr
